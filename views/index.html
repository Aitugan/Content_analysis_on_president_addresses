<!DOCTYPE html>
<html>

<head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>

    <style>
        .legend {
            display: flex;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            margin-right: 10px;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            margin-right: 5px;
        }
    </style>

</head>

<body>
    <form id="eventForm">
        <label for="eventDate">Select Date:</label>
        <select id="eventDate" name="eventDate" required>
            <option value="" disabled selected>Select a Date</option>
        </select>
        <br>

        <label for="eventDescription">Event Description:</label><br>
        <textarea id="eventDescription" name="eventDescription" rows="4" cols="50" required></textarea>
        <br>

        <input type="submit" value="Add Event">
    </form>
    <br>

    <div class="legend" id="legend-box"></div>

    <script>
        let TOPICS = {
            "economic": ["Экономика", [220, 120, 0]],
            "culture": ["Культура", [0, 150, 150]],
            "medicine": ["Медицина", [153, 0, 153]],
            "science": ["Наука", [128, 128, 0]],
            "tech": ["Технологии", [200, 158, 158]],
            "tengri-sport": ["Sport", [128, 0, 128]],
            "life": ["Жизнь", [128, 200, 188]],
            "show": ["Шоу-бизнес", [255, 165, 0]],
            "accidents": ["Происшествия", [76, 153, 0]],
            "crime": ["Преступность", [102, 0, 0]],
            "undefined topic": ["Неизвестный топик", [128, 128, 128]]
        }

        const legendBox = document.getElementById("legend-box");

        // Loop through the countryColors object and create legend items
        for (const topic in TOPICS) {
            const legendItem = document.createElement("div");
            legendItem.className = "legend-item";

            const legendColor = document.createElement("div");
            legendColor.className = "legend-color";
            legendColor.style.backgroundColor = `rgb(${TOPICS[topic][1][0]}, ${TOPICS[topic][1][1]}, ${TOPICS[topic][1][2]})`;

            const legendLabel = document.createElement("span");
            legendLabel.textContent = TOPICS[topic][0];

            legendItem.appendChild(legendColor);
            legendItem.appendChild(legendLabel);

            legendBox.appendChild(legendItem);
        }

        let data = {
            "01/09/2023": [["креативная индустрия", 0.01604617561926254], ["экономическую модель", 0.01283694049541003], ["конкретный срок", 0.012191751662161514], ["корпоративное кредитование", 0.012191751662161514], ["водный ресурс", 0.010397034239027304], ["справедливый казахстан", 0.009627705371557523], ["отечественный производитель", 0.008317627391221844], ["горнорудный сектор", 0.00812783444144101], ["обязательный платёж", 0.00812783444144101], ["водосберегающая технология", 0.00812783444144101]],
            "01/09/2022": [["синтетический наркотик", 0.012052145023507332, "accidents"], ["январское событие", 0.009488098732903343, "crime"], ["успешная нация", 0.008034763349004888, "medicine"], ["общенациональный интерес", 0.008034763349004888, "economic"], ["инвестиционная привлекательность", 0.006325399155268895, "economic"], ["базовый фактор", 0.006325399155268895, "science"], ["электоральный цикл", 0.012052145023507332, "tech"], ["решающая роль", 0.008034763349004888, "science"], ["светлое будущее", 0.006325399155268895, "economic"], ["политическая модернизация", 0.008131485206349601, "culture"]], "16/03/2022": [["январское событие", 0.028464296198710024, "crime"], ["новый казахстан", 0.030004227249963857, "crime"], ["административно-территориальное устройство", 0.016069526698009776, "life"], ["верхняя палата", 0.016069526698009776, "culture"], ["нижняя палата", 0.016069526698009776, "science"], ["трагический январь", 0.015813497888172236, "culture"], ["политическая модернизация", 0.012197227809524402, "culture"], ["генеральная прокуратура", 0.009488098732903343, "tengri-sport"], ["избирательная система", 0.009488098732903343, "life"], ["конституционный совет", 0.009232069923065802, "life"]], "01/09/2021": [["государственный финансы", 0.008034763349004888, "tech"], ["фундаментальная наука", 0.008034763349004888, "science"], ["государственная политика", 0.008034763349004888, "life"], ["официальный язык", 0.008034763349004888, "economic"], ["профильное министерство", 0.007988227802786827, "culture"], ["национальный проект", 0.009232069923065802, "economic"], ["досрочное использование", 0.008034763349004888, "culture"], ["национальный план", 0.006325399155268895, "show"], ["медицинское изделие", 0.006325399155268895, "tech"], ["подушевой финансирование", 0.006325399155268895, "economic"]], "01/09/2020": [["квазигосударственный сектор", 0.009040302520304728, "accidents"], ["ответственный секретарь", 0.009488098732903343, "science"], ["нередкий случай", 0.009488098732903343, "medicine"], ["профессиональный кадр", 0.009488098732903343, "show"], ["налоговое обязательство", 0.008034763349004888, "life"], ["экспортная поддержка", 0.008034763349004888, "tengri-sport"], ["промышленный потенциал", 0.008034763349004888, "economic"], ["внебюджетный фонд", 0.008034763349004888, "tech"], ["нормативно-правовая база", 0.008034763349004888, "crime"], ["базовый элемент", 0.008034763349004888, "tech"]], "02/09/2019": [["актуальная задача", 0.009488098732903343, "tengri-sport"], ["государственная компания", 0.009488098732903343, "economic"], ["жилищная политика", 0.007988227802786827, "accidents"], ["многодетная семья", 0.007988227802786827, "accidents"], ["общественный диалог", 0.007988227802786827, "life"], ["предвыборную программа", 0.008034763349004888, "culture"], ["законодательный характер", 0.008034763349004888, "life"], ["надлежащее условие", 0.008034763349004888, "economic"], ["природный газа", 0.008034763349004888, "economic"], ["социальная помощь", 0.007232242016243783, "life"]], "05/10/2018": [["минимальная зарплата", 0.008034763349004888, "science"], ["безопасное проживание", 0.008034763349004888, "economic"], ["большим внимание", 0.012052145023507332, "show"], ["каждое направление", 0.008034763349004888, "science"], ["несвойственная функция", 0.008034763349004888, "life"], ["государственная политика", 0.008034763349004888, "life"], ["данный проект", 0.008034763349004888, "economic"], ["внутреннее дело", 0.005424181512182837, "show"], ["социальное самочувствие", 0.005325485201857884, "life"], ["жилищное условие", 0.005325485201857884, "tech"]], "09/01/2018": [["промышленная революция", 0.015813497888172236, "science"], ["технологический уклад", 0.012052145023507332, "science"], ["трудового стаж", 0.009488098732903343, "tech"], ["продуктивная занятость", 0.008034763349004888, "tech"], ["электронная биржа", 0.008034763349004888, "tech"], ["умный город", 0.006325399155268895, "life"], ["информационная система", 0.006924052442299352, "accidents"], ["больший данные", 0.006325399155268895, "economic"], ["новый навык", 0.006325399155268895, "life"], ["этот опыт", 0.006924052442299352, "science"]], "30/01/2017": [["новая индустрия", 0.016069526698009776, "show"], ["третья модернизация", 0.015976455605573654, "tech"], ["большим внимание", 0.012052145023507332, "show"], ["комплексная задача", 0.012052145023507332, "economic"], ["транзитная перевозка", 0.008034763349004888, "tech"], ["всё законодательство", 0.008034763349004888, "tech"], ["налоговая льгота", 0.006325399155268895, "tech"], ["глобальная конкурентоспособность", 0.005325485201857884, "show"], ["массовое предпринимательство", 0.005325485201857884, "crime"], ["финансовая грамотность", 0.005325485201857884, "tech"]], "18/01/2014": [["зелёная экономика", 0.016069526698009776, "economic"], ["наукоёмкая экономика", 0.016069526698009776, "economic"], ["традиционная отрасль", 0.01265079831053779, "science"], ["развитая страна", 0.011965549356151952, "economic"], ["научная разработка", 0.006325399155268895, "science"], ["нефтеперерабатывающий завод", 0.006325399155268895, "crime"], ["нефтеперерабатывающий завод", 0.006325399155268895, "crime"], ["всеобщий труд", 0.005325485201857884, "medicine"], ["единая цель", 0.008034763349004888, "science"], ["главная цель", 0.004360006151695362, "life"]], "14/12/2012": [["синтетический наркотик", 0.026627426009289423, "accidents"], ["казахстанский патриотизм", 0.018976197465806685, "accidents"], ["экономический прагматизм", 0.016069526698009776, "economic"], ["хорошее образование", 0.016069526698009776, "life"], ["казахский язык", 0.01453335383898454, "tech"], ["национальная экономика", 0.013080018455086086, "accidents"], ["социальная безопасность", 0.012052145023507332, "culture"], ["глобальный кризис", 0.012052145023507332, "economic"], ["демографический дисбаланс", 0.012052145023507332, "science"], ["индустриальная революция", 0.009488098732903343, "tech"]], "27/01/2012": [["электронная форма", 0.01265079831053779, "science"], ["горнолыжный курорт", 0.008034763349004888, "life"], ["евразийская интеграция", 0.008034763349004888, "science"], ["ядерная безопасность", 0.006325399155268895, "accidents"], ["инвестиционный климат", 0.004065742603174801, "tech"], ["актуальная тема", 0.004017381674502444, "economic"], ["пилотный режим", 0.004017381674502444, "economic"], ["весь казахстанец", 0.004017381674502444, "show"], ["наша конституция", 0.004017381674502444, "tengri-sport"], ["южный регион", 0.004017381674502444, "life"]], "28/01/2011": [["таможенный союз", 0.009232069923065802, "crime"], ["государственный язык", 0.004853957049196678, "culture"], ["питьевой вода", 0.004242669618856284, "life"], ["суверенное развитие", 0.004017381674502444, "tech"], ["индустриальная пятилетка", 0.004017381674502444, "tech"], ["сельская индустриализация", 0.004017381674502444, "crime"], ["разрешительный документ", 0.004017381674502444, "life"], ["активное восстановление", 0.004017381674502444, "economic"], ["главный итог", 0.004017381674502444, "life"], ["индустриальная революция", 0.004017381674502444, "tech"]], "29/01/2010": [["экономический подъём", 0.012052145023507332, "tech"], ["новое десятилетие", 0.010650970403715768, "economic"], ["индустриальное развитие", 0.008034763349004888, "science"], ["правоохранительная система", 0.006540517636777205, "culture"], ["научный центр", 0.006325399155268895, "life"], ["финансовая система", 0.006098613904762201, "economic"], ["этот показатель", 0.005325485201857884, "life"], ["внутренняя потребность", 0.005325485201857884, "culture"], ["инновационную система", 0.005325485201857884, "tech"], ["новый рынок", 0.005325485201857884, "tech"]], "06/03/2009": [["мирового кризис", 0.012197227809524402, "show"], ["финансовая дисциплина", 0.008034763349004888, "tengri-sport"], ["транзитный коридор", 0.008034763349004888, "economic"], ["глобальный кризис", 0.006325399155268895, "economic"], ["нефтеперерабатывающий завод", 0.006325399155268895, "crime"], ["финансовый рынок", 0.004616034961532901, "economic"], ["антикризисная мера", 0.004065742603174801, "accidents"], ["финансовая система", 0.004065742603174801, "economic"], ["реальный успех", 0.004017381674502444, "economic"], ["продовольственный кризис", 0.004017381674502444, "science"]], "16/02/2008": [["современный этап", 0.009488098732903343, "science"], ["корпоративный лидер", 0.008034763349004888, "tech"], ["государственная политика", 0.008034763349004888, "life"], ["административная реформа", 0.00726667691949227, "economic"], ["банковский сектор", 0.006924052442299352, "economic"], ["вооружённая сила", 0.0064719427322622375, "crime"], ["социальное благополучие", 0.006325399155268895, "accidents"], ["эту земля", 0.006325399155268895, "science"], ["финансовая система", 0.004065742603174801, "economic"], ["бюджетное планирование", 0.004065742603174801, "accidents"]], "28/02/2007": [["минеральный ресурс", 0.024104290047014663, "tech"], ["целостная стратегия", 0.02008690837251222, "life"], ["дальнейшая индустриализация", 0.02008690837251222, "accidents"], ["корпоративное управление", 0.016156122365365153, "economic"], ["умная экономика", 0.016069526698009776, "economic"], ["экспортная ниша", 0.016069526698009776, "economic"], ["недвижимое имущество", 0.01265079831053779, "show"], ["технический стандарт", 0.012052145023507332, "tech"], ["перспективное производство", 0.012052145023507332, "medicine"], ["приоритетный сектор", 0.012052145023507332, "tech"]], "01/03/2006": [["практическую реализация", 0.018464139846131603, "tech"], ["легальный оборот", 0.016069526698009776, "economic"], ["социальная ответственность", 0.013313713004644711, "economic"], ["социальное обслуживание", 0.012052145023507332, "economic"], ["экономическую модернизация", 0.009232069923065802, "science"], ["территориальное развитие", 0.008131485206349601, "crime"], ["авторское право", 0.008034763349004888, "science"], ["инкубационный проект", 0.008034763349004888, "science"], ["транспортная стратегия", 0.008034763349004888, "tech"], ["государственный менеджер", 0.008034763349004888, "tech"]], "16/02/2005": [["общенациональная программа", 0.018976197465806685, "medicine"], ["западная демократия", 0.01265079831053779, "science"], ["инновационную экономика", 0.009488098732903343, "accidents"], ["социальный прогресс", 0.008034763349004888, "science"], ["межконфессиональное согласие", 0.009040302520304728, "life"], ["государственная политика", 0.008034763349004888, "life"], ["сельскохозяйственное сырьё", 0.008034763349004888, "tech"], ["национальный университет", 0.008034763349004888, "culture"], ["такого объединение", 0.008034763349004888, "life"], ["индустриальная программа", 0.006325399155268895, "science"]], "14/03/2004": [["материально-техническая база", 0.018976197465806685, "tengri-sport"], ["квадратный метр", 0.012197227809524402, "accidents"], ["жилищное строительство", 0.009546006642426639, "economic"], ["государственная политика", 0.008034763349004888, "life"], ["политический авторитет", 0.008034763349004888, "culture"], ["человеческое развитие", 0.008034763349004888, "medicine"], ["эффективное управление", 0.008034763349004888, "medicine"], ["капитальный ремонт", 0.006325399155268895, "accidents"], ["социальное заказ", 0.006325399155268895, "economic"], ["системное изменение", 0.006325399155268895, "science"]], "16/04/2003": [["социальное развитие", 0.012197227809524402, "medicine"], ["сельская экономика", 0.008034763349004888, "economic"], ["международный договор", 0.006325399155268895, "tengri-sport"], ["агропродовольственная программа", 0.005325485201857884, "medicine"], ["социальная справедливость", 0.005325485201857884, "culture"], ["государственное устройство", 0.004616034961532901, "life"], ["банковская система", 0.004065742603174801, "economic"], ["региональная политика", 0.004065742603174801, "crime"], ["политический катаклизм", 0.004017381674502444, "science"], ["долевого участие", 0.004017381674502444, "economic"]], "16/04/2002": [["сельское население", 0.016069526698009776, "medicine"], ["сельский район", 0.008034763349004888, "science"], ["бюрократический произвол", 0.008034763349004888, "tech"], ["основный закон", 0.008034763349004888, "medicine"], ["малый город", 0.005325485201857884, "culture"], ["каждый год", 0.004616034961532901, "medicine"], ["целый ряд", 0.004065742603174801, "life"], ["наша зрелость", 0.004017381674502444, "culture"], ["огромное расстояние", 0.004017381674502444, "science"], ["самодостаточное государство", 0.004017381674502444, "life"]], "16/09/2001": [["большая задача", 0.009488098732903343, "science"], ["этот договор", 0.008034763349004888, "culture"], ["свою важность", 0.008034763349004888, "tengri-sport"], ["краснооктябрьский рудник", 0.008034763349004888, "life"], ["один миллиард", 0.008034763349004888, "culture"], ["предпринимательская структура", 0.008034763349004888, "economic"], ["внутреннее войско", 0.008034763349004888, "culture"], ["повышенное внимание", 0.008034763349004888, "medicine"], ["должностном оклад", 0.007988227802786827, "economic"], ["наша жизнь", 0.006325399155268895, "show"]], "16/10/2000": [["эту страна", 0.010650970403715768, "economic"], ["двадцатый век", 0.009488098732903343, "medicine"], ["эту истина", 0.008034763349004888, "medicine"], ["собственную государственность", 0.008034763349004888, "accidents"], ["оперный театр", 0.008034763349004888, "culture"], ["бюджетный дефицит", 0.008034763349004888, "crime"], ["первый сентябрь", 0.008034763349004888, "tengri-sport"], ["политическую история", 0.008034763349004888, "economic"], ["локальная война", 0.008034763349004888, "science"], ["незримая угроза", 0.008034763349004888, "science"]], "16/09/1999": [["новый век", 0.012052145023507332, "medicine"], ["новое столетие", 0.009488098732903343, "culture"], ["первый век", 0.009488098732903343, "tech"], ["своё прошлое", 0.008034763349004888, "show"], ["второго тысячелетие", 0.008034763349004888, "science"], ["переломное время", 0.006325399155268895, "science"], ["вооружённый конфликт", 0.006325399155268895, "life"], ["наша история", 0.004853957049196678, "tengri-sport"], ["национальная история", 0.004616034961532901, "culture"], ["редкий день", 0.004017381674502444, "show"]], "16/09/1998": [["целевой группа", 0.015813497888172236, "medicine"], ["всю строгость", 0.012052145023507332, "life"], ["специальный доклад", 0.008034763349004888, "economic"], ["следующая программа", 0.008034763349004888, "show"], ["активная деятельность", 0.008034763349004888, "medicine"], ["коллективная ответственность", 0.008034763349004888, "culture"], ["справедливый выборы", 0.008034763349004888, "life"], ["та мечта", 0.008034763349004888, "tengri-sport"], ["личная ответственность", 0.007988227802786827, "economic"], ["наш ребёнок", 0.00726667691949227, "life"]], "16/10/1997": [["долгосрочный приоритет", 0.039236297173029656, "economic"], ["наша стратегия", 0.019888665544670402, "tech"], ["энергетический ресурс", 0.018976197465806685, "science"], ["переходный период", 0.018639198206502595, "science"], ["приоритетная цель", 0.016156122365365153, "economic"], ["сильная сторона", 0.015813497888172236, "life"], ["наш ребёнок", 0.01453335383898454, "life"], ["долгосрочная перспектива", 0.013313713004644711, "tech"], ["народная пословица", 0.01265079831053779, "culture"], ["иностранная инвестиция", 0.012393919293508337, "economic"]]
        }

        const eventDateSelect = document.getElementById("eventDate");
        const eventForm = document.getElementById("eventForm");
        let events = {};

        function setup() {
            createCanvas(15000, 1200);
        }

        for (const date in data) {
            if (data.hasOwnProperty(date)) {
                const option = document.createElement("option");
                option.value = date;
                option.text = date;
                eventDateSelect.appendChild(option);
            }
        }

        eventForm.addEventListener("submit", function (event) {
            event.preventDefault();

            const selectedDate = eventDateSelect.value;
            const eventDescription = document.getElementById("eventDescription").value;

            if (selectedDate && eventDescription) {
                events[selectedDate] = eventDescription;
                saveEventToLocalStorage(events);
                dateInput.value = '';
                descriptionInput.value = '';
                loadEventsFromLocalStorage(); // Reload events after saving

            } else {
                console.log("Please select a date and enter an event description.");
            }
        });

        function draw() {
            background(255)
            loadEventsFromLocalStorage();
            let years = Object.keys(data);
            let maxItems = 0;
            let minScore = 0;
            let maxScore = 0.04;

            for (let year of years) {
                let items = data[year];
                maxItems = max(maxItems, items.length);
            }

            let scoreUnit = (height - 30) / (maxScore - minScore);

            textAlign(CENTER, CENTER);
            textSize(12);

            stroke(0);
            line(0, height - 330, width, height - 330);

            textAlign(RIGHT, CENTER);
            for (let s = minScore; s <= maxScore; s++) {
                let y = height - 30 - ((s - minScore) * scoreUnit);
                fill(0);
                text(s, 40, y - 290);
                stroke(150);
                line(50, y - 300, width, y - 300);
            }

            let wordPositions = {};
            let prevPositions = {};
            let prevWidths = {};

            let x;
            let rectWidth = 250;
            let rectHeight = 55;

            for (let i = 0; i < years.length; i++) {
                let year = years[i];
                let items = data[year];

                items.sort((a, b) => a[1] - b[1]);

                x = (i * (width - rectWidth * 25)) / years.length + 70;

                let timesUsed = 0

                for (let j = 0; j < items.length; j++) {
                    let word = items[j][0];
                    let score = items[j][1];
                    let category = items[j][2];

                    let count = countWordsWithScore(items, score);

                    let y = height - 70 * j - 400;


                    fill(TOPICS[category][1]);
                    rect(x, y, rectWidth, rectHeight);
                    fill(255);
                    textSize(12);
                    textWrap(WORD);
                    textAlign(LEFT, TOP);
                    text(word + " " + Math.round(score * 10000) / 10000, x + rectWidth / 3, y + 10, rectWidth / 4);
                    textSize(10);

                    wordPositions[year] = wordPositions[year] || {};
                    wordPositions[year][word] = createVector(x + rectWidth / 2, y + rectHeight / 2);

                    if (prevPositions[word] && i >= 0) {
                        let prevX = prevPositions[word].x + rectWidth / 2;
                        let prevY = prevPositions[word].y;
                        let connectorX1 = prevX;
                        let connectorY1 = prevY;
                        let connectorX2 = x;
                        let connectorY2 = y + rectHeight / 2;
                        stroke(TOPICS[category][1]);
                        strokeWeight(rectHeight);
                        line(connectorX1, connectorY1, connectorX2, connectorY2);
                        stroke(0);
                        strokeWeight(0);
                        fill(100, 100, 200);
                    }

                }
                prevPositions = { ...wordPositions[year] };

                fill(0);
                text(year, x + rectWidth / 2, height - 300);

                // Draw events
                let eventX = x + rectWidth + 20;
                let eventY = height - (height - 100);
                let eventWidth = 50;
                let eventHeight = 770;
                fill(200, 100, 100);
                rect(eventX, eventY, eventWidth, eventHeight);

                fill(0)
                textSize(10);
                textAlign(LEFT, TOP);
                textWrap(WORD);
                text(splitLongText(events[year]), eventX, eventY + eventHeight + 10);

            }
        }

        function countWordsWithScore(items, score) {
            let count = 0;
            for (let item of items) {
                if (item[1] === score) {
                    count++;
                }
            }
            return count;
        }

        function splitLongText(text) {
            if (text === undefined) {
                return;
            }
            let words = text.split(' ');
            let result = '';
            let lineLength = 0;

            for (let i = 0; i < words.length; i++) {
                if (lineLength + words[i].length <= 10) {
                    result += words[i] + ' ';
                    lineLength += words[i].length + 1;
                } else {
                    result += '\n' + words[i] + ' ';
                    lineLength = words[i].length + 1;
                }
            }

            return result.trim();
        }
        function saveEventToLocalStorage(events) {
            localStorage.setItem('events', JSON.stringify(events));
        }

        function loadEventsFromLocalStorage() {
            const storedEvents = localStorage.getItem('events');
            if (storedEvents) {
                events = JSON.parse(storedEvents);
            }
        }


    </script>
</body>

</html>